<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
</head>
<body>
	<!-- -------- -->
	<!-- SCENARIO -->
	<!-- -------- -->
	<div th:fragment="scenario" x-bind:id="'scenario_' + scenario.id" x-data="scenarioData(scenarioId, scenarioPath)">
		<template x-if="Object.keys(scenario).length > 0">
			<div class="scenario">
				<!-- Title -->
				<div class="title">
					<!-- Questline -->
					<div th:if="*{questLine}" class="questLine" th:classappend="*{#strings.unCapitalize(questLine.name())}">
						[[*{questLine}]]
					</div>
					<h1>
						<!-- Id and name -->
						<span class="titleSecondary">[[*{#numbers.formatInteger(id,1)}]] Â·</span> [[*{name}]]
						<!-- Requirements -->
						<th:block th:if="*{requirement}">
							<th:block th:replace="~{:: requirement(*{requirement})}"></th:block>
						</th:block>
					</h1>
					<!-- Unlocked by -->
					<th:block th:if="*{unlockedBy}">
						<th:block th:replace="~{fragments/frosthaven :: unlockedBy(*{unlockedBy})}"></th:block>
					</th:block>
					<!-- Location -->
					<div th:if="*{location}" class="subtitle">
						<i class="fa-solid fa-map-location me-1"></i> [[*{location}]]
					</div>
				</div>

				<!-- Scenario goals -->
				<template x-if="scenario.goals">
					<bs:card class="fhCard goals">
						<bs:cardHeader>[[#{scenario.goals}]]</bs:cardHeader>
						<bs:cardBody x-jsz>
							{{scenario.goals}}
						</bs:cardBody>
					</bs:card>
				</template>
				
				<!-- Scenario effects -->
				<template x-if="scenario.effects">
					<bs:card class="fhCard effects">
						<bs:cardHeader>[[#{scenario.effects}]]</bs:cardHeader>
						<bs:cardBody x-jsz>
							{{scenario.effects}}
						</bs:cardBody>
					</bs:card>
				</template>

				<!-- Sections -->
				<div class="sections">
					<th:block th:each="pathItem : *{path}" th:with="section = *{sections['__${pathItem}__']}">
						<th:block th:if="${section}">
							<div th:replace="~{fragments/section :: section(${section})}"></div>
						</th:block>
					</th:block>
				</div>

				<!-- Random scenario section -->
				<!--
				<th:block th:if="*{randomScenarioSection}">
					<th:block th:replace="~{fragments/section :: section(*{randomScenarioSection})}"></th:block>
				</th:block>
				-->
			</div>
		</template>
	</div>


	<!-- ----------- -->
	<!-- REQUIREMENT -->
	<!-- ----------- -->
	<div th:fragment="requirement(requirement)" th:object="${requirement}" class="requirement">
		<!-- Transport -->
		<div th:if="*{transport}" class="transport">
			<img th:src="@{__${imgUrl}__/icons/{transport}.png(transport=*{transport})}">
		</div>
		<!-- Status -->
		<div th:if="*{status}" class="status">
			[[*{status}]]
		</div>
	</div>


	<!-- ----------- -->
	<!-- SCENARIO JS -->
	<!-- ----------- -->
	<script th:fragment="scenarioJs" th:inline="javascript">
		document.addEventListener("alpine:init", () => {
			Alpine.data("scenarioData", (scenarioId, scenarioPath) => ({
				scenarioPath: scenarioPath ?? [],
				scenario: {},

				init() {
					this.setScenario(scenarioId, false);
					// Event listeners
					window.addEventListener("changed-scenario-id", event => this.setScenario(event.detail));
					window.addEventListener("changed-scenario-path", event => this.setScenarioPath(event.detail));
				},

				// "changed-scenario-id" event handler
				setScenario(scenarioId, clearScenarioPath = true) {
					log.entry(scenarioId, clearScenarioPath);
					if (scenarioId) this.scenario = this.$store.scenariosMap[scenarioId] ?? {};
					if (clearScenarioPath) this.scenarioPath = [];
					log.exit();
				},

				// "changed-scenario-path" event handler
				setScenarioPath(newScenarioPath) {
					log.entry(newScenarioPath);
					this.scenarioPath = [...newScenarioPath];
					log.exit();
				}
			}));
		});
	</script>
</body>
</html>